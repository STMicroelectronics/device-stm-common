From 023582fc1466429394b17f73ca8f1b0296e41e95 Mon Sep 17 00:00:00 2001
From: frq09432 <nicolas.louboutin@st.com>
Date: Tue, 11 Sep 2018 10:59:04 +0200
Subject: [PATCH 2/4] drm_hwcomposer: Insure that the layer is compatible with
 the plan capability

  By default, consider that the plan is not compatible
  TODO: manage the compatibility dynamically
---
 drmhwctwo.cpp | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/drmhwctwo.cpp b/drmhwctwo.cpp
index 16550ad..79ef2d4 100644
--- a/drmhwctwo.cpp
+++ b/drmhwctwo.cpp
@@ -758,6 +758,12 @@ HWC2::Error DrmHwcTwo::HwcDisplay::ValidateDisplay(uint32_t *num_types,
   if (avail_planes < layers_.size())
     avail_planes--;
 
+  /* By default, if only one layer available, consider that it has not a compatible format
+   * TODO: Check that the validated layer has a compatible format
+   */
+  if (layers_.size() == 1)
+    avail_planes--;
+
   for (std::pair<const uint32_t, DrmHwcTwo::HwcLayer *> &l : z_map) {
     if (comp_failed || !avail_planes--)
       break;
-- 
2.7.4

