From 55ce00b554d511b4bf9864958b14647e46757474 Mon Sep 17 00:00:00 2001
From: frq09432 <nicolas.louboutin@st.com>
Date: Thu, 23 Jan 2020 16:16:17 +0100
Subject: [PATCH 1/3] Integration of Copro HAL

Signed-off-by: Nicolas LOUBOUTIN <nicolas.louboutin@st.com>
Change-Id: I4c37708e0f790ff8061cf83f9e5ce477813bea50
---
 copro/1.0/Android.bp              | 23 ++++++++++
 copro/1.0/ICopro.hal              | 62 +++++++++++++++++++++++++++
 copro/1.0/ICoproSerialPortHal.hal | 70 +++++++++++++++++++++++++++++++
 copro/1.0/types.hal               | 53 +++++++++++++++++++++++
 current.txt                       |  5 +++
 5 files changed, 213 insertions(+)
 create mode 100644 copro/1.0/Android.bp
 create mode 100644 copro/1.0/ICopro.hal
 create mode 100644 copro/1.0/ICoproSerialPortHal.hal
 create mode 100644 copro/1.0/types.hal

diff --git a/copro/1.0/Android.bp b/copro/1.0/Android.bp
new file mode 100644
index 000000000..582b95fbe
--- /dev/null
+++ b/copro/1.0/Android.bp
@@ -0,0 +1,23 @@
+// This file is autogenerated by hidl-gen -Landroidbp.
+
+hidl_interface {
+    name: "android.hardware.copro@1.0",
+    root: "android.hardware",
+    vndk: {
+        enabled: true,
+    },
+    srcs: [
+        "types.hal",
+        "ICopro.hal",
+        "ICoproSerialPortHal.hal",
+    ],
+    interfaces: [
+        "android.hidl.base@1.0",
+    ],
+    types: [
+        "HalFwInfo",
+        "RequestStatus",
+        "TtyMode",
+    ],
+    gen_java: true,
+}
diff --git a/copro/1.0/ICopro.hal b/copro/1.0/ICopro.hal
new file mode 100644
index 000000000..c336ae3d5
--- /dev/null
+++ b/copro/1.0/ICopro.hal
@@ -0,0 +1,62 @@
+/*
+ * Copyright (C) 2016 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.hardware.copro@1.0;
+
+interface ICopro {
+    /**
+     * This function return the fw list.
+     *
+     * @param   void
+     * @return  debugErrno
+     * @return  fwInfoList
+     */
+    getFwList() generates (RequestStatus debugErrno, vec<HalFwInfo> fwInfoList);
+
+    /**
+     * This function return the fw info.
+     *
+     * @param   void
+     * @return  debugErrno
+     * @return  fwInfo
+     */
+    getFwByName(string name) generates (RequestStatus debugErrno, HalFwInfo fwInfo);
+
+    /**
+     * This function return if the fw is running.
+     *
+     * @param   id
+     * @return  debugErrno
+     * @return  runningState
+     */
+    isFwRunning(uint32_t id) generates (RequestStatus debugErrno, bool runningState);
+
+    /**
+     * This function start the fw.
+     *
+     * @param   id
+     * @return  debugErrno
+     */
+    startFw(uint32_t id) generates (RequestStatus debugErrno);
+
+    /**
+     * This function stop the fw.
+     *
+     * @param   id
+     * @return  debugErrno
+     */
+    stopFw(uint32_t id) generates (RequestStatus debugErrno);
+};
diff --git a/copro/1.0/ICoproSerialPortHal.hal b/copro/1.0/ICoproSerialPortHal.hal
new file mode 100644
index 000000000..d8aae9a08
--- /dev/null
+++ b/copro/1.0/ICoproSerialPortHal.hal
@@ -0,0 +1,70 @@
+/*
+ * Copyright (C) 2016 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.hardware.copro@1.0;
+
+interface ICoproSerialPortHal {
+    /**
+     * It open the tty connection.
+     *
+     * @param   mode
+     * @return  debugErrno
+     */
+    open(TtyMode mode) generates (RequestStatus debugErrno);
+
+    /**
+     * It close the tty connection.
+     *
+     * @param   void
+     * @return  debugErrno
+     */
+    close() generates (RequestStatus debugErrno);
+
+    /**
+     * Read the string content of the tty connection.
+     *
+     * @param   void
+     * @return  debugErrno
+     * @return  result
+     */
+    read() generates (RequestStatus debugErrno, string result);
+
+    /**
+     * Read the byte content of the tty connection.
+     *
+     * @param   size
+     * @return  debugErrno
+     * @return  result
+     */
+    readB(uint32_t size) generates (RequestStatus debugErrno, vec<uint8_t> result);
+
+    /**
+     * Write string data to the tty.
+     *
+     * @param   command
+     * @return  debugErrno
+     */
+    write(string command) generates (RequestStatus debugErrno);
+
+    /**
+     * Write byte data to the tty.
+     *
+     * @param   command
+     * @return  debugErrno
+     * @return  lenght
+     */
+    writeB(vec<uint8_t> command) generates (RequestStatus debugErrno, uint32_t lenght);
+};
diff --git a/copro/1.0/types.hal b/copro/1.0/types.hal
new file mode 100644
index 000000000..c1c85bd3c
--- /dev/null
+++ b/copro/1.0/types.hal
@@ -0,0 +1,53 @@
+/*
+ * Copyright (C) 2016 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.hardware.copro@1.0;
+
+enum TtyMode : uint32_t {
+    /**
+     * TTY in NORMAL mode
+     */
+    MODE_NORMAL = 0,
+
+    /**
+     * TTY in RAW mode
+     */
+    MODE_RAW = 1,
+};
+
+/**
+ * Used as a container to send port role information.
+ */
+struct HalFwInfo {
+    /**
+     * The firware ID
+     */
+    uint32_t id;
+
+    /**
+     * The firmware name
+     */
+    string name;
+
+    /**
+     * The firmware state
+     */
+    bool state;
+};
+
+struct RequestStatus { /* Voir si on fait des exceptions, ou string etc... */
+    bool ret; /* Voir si besoin de plus de pr√©cision sur le retour */
+};
diff --git a/current.txt b/current.txt
index 669651625..ddc6fd426 100644
--- a/current.txt
+++ b/current.txt
@@ -394,6 +394,11 @@ e362203b941f18bd4cba29a62adfa02453ed00d6be5b72cdb6c4d7e0bf394a40 android.hardwar
 cd4330c3196bda1d642a32abfe23a7d64ebfbda721940643af6867af3b3f0aa9 android.hardware.wifi.supplicant@1.1::ISupplicantStaIfaceCallback
 10ff2fae516346b86121368ce5790d5accdfcb73983246b813f3d488b66db45a android.hardware.wifi.supplicant@1.1::ISupplicantStaNetwork
 
+# Add Copro HALs
+c2aa62be97e499be9b9cf10fef841e1da9b80524b3accfa3f73c1b5eea649178 android.hardware.copro@1.0::types
+842e6428ca2851977d306fa18c6db359c9b8133567684a37acceeb92a17c2d6b android.hardware.copro@1.0::ICopro
+df111f3bd9a752ead6cdd91a97e1ab61eceee8e7ce5976e2bf8809939adcf2e7 android.hardware.copro@1.0::ICoproSerialPortHal
+
 # ABI preserving changes to HALs during Android Q
 2a55e224aa9bc62c0387cd85ad3c97e33f0c33a4e1489cbae86b2523e6f9df35 android.hardware.camera.device@3.2::ICameraDevice
 17e878cb11ea602c08af04a09182e6265498be16edf26605058383b9a7628261 android.hardware.camera.device@3.2::ICameraDeviceCallback
-- 
2.17.1

