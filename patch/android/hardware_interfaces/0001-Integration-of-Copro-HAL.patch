From 74452e527ba0b31fcf301090a040b04b46fd93e2 Mon Sep 17 00:00:00 2001
From: frq09432 <nicolas.louboutin@st.com>
Date: Mon, 24 Jun 2019 10:45:24 +0200
Subject: [PATCH 1/4] Integration of Copro HAL

Change-Id: I4c37708e0f790ff8061cf83f9e5ce477813bea50
---
 copro/1.0/Android.bp              | 24 +++++++++++++++
 copro/1.0/ICopro.hal              | 63 +++++++++++++++++++++++++++++++++++++++
 copro/1.0/ICoproSerialPortHal.hal | 52 ++++++++++++++++++++++++++++++++
 copro/1.0/types.hal               | 54 +++++++++++++++++++++++++++++++++
 current.txt                       |  5 ++++
 5 files changed, 198 insertions(+)
 create mode 100644 copro/1.0/Android.bp
 create mode 100644 copro/1.0/ICopro.hal
 create mode 100644 copro/1.0/ICoproSerialPortHal.hal
 create mode 100644 copro/1.0/types.hal

diff --git a/copro/1.0/Android.bp b/copro/1.0/Android.bp
new file mode 100644
index 0000000..701b06e
--- /dev/null
+++ b/copro/1.0/Android.bp
@@ -0,0 +1,24 @@
+// This file is autogenerated by hidl-gen -Landroidbp.
+
+hidl_interface {
+    name: "android.hardware.copro@1.0",
+    root: "android.hardware",
+    vndk: {
+        enabled: true,
+    },
+    srcs: [
+        "types.hal",
+        "ICopro.hal",
+        "ICoproSerialPortHal.hal",
+    ],
+    interfaces: [
+        "android.hidl.base@1.0",
+    ],
+    types: [
+        "HalFwInfo",
+        "RequestStatus",
+        "TtyMode",
+    ],
+    gen_java: true,
+}
+
diff --git a/copro/1.0/ICopro.hal b/copro/1.0/ICopro.hal
new file mode 100644
index 0000000..c7728dc
--- /dev/null
+++ b/copro/1.0/ICopro.hal
@@ -0,0 +1,63 @@
+/*
+ * Copyright (C) 2016 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.hardware.copro@1.0;
+
+interface ICopro {
+    /**
+     * This function return the fw list.
+     *
+     * @param   void
+     * @return  debugErrno
+     * @return  fwInfoList
+     */
+    getFwList() generates (RequestStatus debugErrno, vec<HalFwInfo> fwInfoList);
+
+    /**
+     * This function return the fw info.
+     *
+     * @param   void
+     * @return  debugErrno
+     * @return  fwInfo
+     */
+    getFwByName(string name) generates (RequestStatus debugErrno, HalFwInfo fwInfo);
+
+    /**
+     * This function return if the fw is running.
+     *
+     * @param   id
+     * @return  debugErrno
+     * @return  runningState
+     */
+    isFwRunning(uint32_t id) generates (RequestStatus debugErrno, bool runningState);
+
+    /**
+     * This function start the fw.
+     *
+     * @param   id
+     * @return  debugErrno
+     */
+    startFw(uint32_t id) generates (RequestStatus debugErrno);
+
+    /**
+     * This function stop the fw.
+     *
+     * @param   id
+     * @return  debugErrno
+     */
+    stopFw(uint32_t id) generates (RequestStatus debugErrno);
+};
+
diff --git a/copro/1.0/ICoproSerialPortHal.hal b/copro/1.0/ICoproSerialPortHal.hal
new file mode 100644
index 0000000..a74de06
--- /dev/null
+++ b/copro/1.0/ICoproSerialPortHal.hal
@@ -0,0 +1,52 @@
+/*
+ * Copyright (C) 2016 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.hardware.copro@1.0;
+
+interface ICoproSerialPortHal {
+    /**
+     * It open the tty connection.
+     *
+     * @param   mode
+     * @return  debugErrno
+     */
+    open(TtyMode mode) generates (RequestStatus debugErrno);
+
+    /**
+     * It close the tty connection.
+     *
+     * @param   void
+     * @return  debugErrno
+     */
+    close() generates (RequestStatus debugErrno);
+
+    /**
+     * Read the content of the tty connection.
+     *
+     * @param   void
+     * @return  debugErrno
+     * @return  result
+     */
+    read() generates (RequestStatus debugErrno, string result);
+
+    /**
+     * Wrtie data to the tty.
+     *
+     * @param   command
+     * @return  debugErrno
+     */
+    write(string command) generates (RequestStatus debugErrno);
+};
diff --git a/copro/1.0/types.hal b/copro/1.0/types.hal
new file mode 100644
index 0000000..b48acfc
--- /dev/null
+++ b/copro/1.0/types.hal
@@ -0,0 +1,54 @@
+/*
+ * Copyright (C) 2016 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.hardware.copro@1.0;
+
+enum TtyMode : uint32_t {
+    /**
+     * TTY in NORMAL mode
+     */
+    MODE_NORMAL = 0,
+
+    /**
+     * TTY in RAW mode
+     */
+    MODE_RAW = 1,
+};
+
+/**
+ * Used as a container to send port role information.
+ */
+struct HalFwInfo {
+    /**
+     * The firware ID
+     */
+    uint32_t id;
+
+    /**
+     * The firmware name
+     */
+    string name;
+
+    /**
+     * The firmware state
+     */
+    bool state;
+};
+
+struct RequestStatus { /* Voir si on fait des exceptions, ou string etc... */
+    bool ret; /* Voir si besoin de plus de pr√©cision sur le retour */
+};
+
diff --git a/current.txt b/current.txt
index 4f574e9..32cfe96 100644
--- a/current.txt
+++ b/current.txt
@@ -387,3 +387,8 @@ cd4330c3196bda1d642a32abfe23a7d64ebfbda721940643af6867af3b3f0aa9 android.hardwar
 # ABI preserving changes to HALs after Android P
 1d19720d4fd38b1095f0f555a4bd92b3b12c9b1d0f560b0e9a474cd6dcc20db6 android.hardware.radio@1.2::IRadio
 1d4a5776614c08b5d794a5ec5ab04697260cbd4b3441d5935cd53ee71d19da02 android.hardware.radio@1.0::IRadioResponse
+
+# Add Copro HALs
+fe093bf4dacfd048c1be7b233ac6bd678f0f33bbeb812fd4364bcc82f12d0de4 android.hardware.copro@1.0::types
+ad7e5475dd5de5e956bd0d781bb9d29891e88639c7327f4ae4d3e2dc96cdd64a android.hardware.copro@1.0::ICopro
+62d7af09e29f78070dc5bd9d711a345cf7e1427ba70fc1636715e829d51f96d7 android.hardware.copro@1.0::ICoproSerialPortHal
-- 
2.7.4

