From d2bea21a9913f446b6fcb632ab82190f583b80fb Mon Sep 17 00:00:00 2001
From: frq09432 <nicolas.louboutin@st.com>
Date: Mon, 9 Dec 2019 11:25:28 +0100
Subject: [PATCH] Remove TelecomService

Change-Id: I970118fe0ce5649228b93358a49a0c64e203bf3a
---
 .../src/com/android/keyguard/EmergencyButton.java        |  3 +--
 .../core/java/com/android/server/audio/AudioService.java | 16 ++--------------
 services/java/com/android/server/SystemServer.java       |  6 +++---
 telecomm/java/android/telecom/DefaultDialerManager.java  |  7 +------
 4 files changed, 7 insertions(+), 25 deletions(-)

diff --git a/packages/SystemUI/src/com/android/keyguard/EmergencyButton.java b/packages/SystemUI/src/com/android/keyguard/EmergencyButton.java
index 210b82d..02c948c 100644
--- a/packages/SystemUI/src/com/android/keyguard/EmergencyButton.java
+++ b/packages/SystemUI/src/com/android/keyguard/EmergencyButton.java
@@ -233,14 +233,13 @@ public class EmergencyButton extends Button {
      * Resumes a call in progress.
      */
     private void resumeCall() {
-        getTelecommManager().showInCallScreen(false);
     }
 
     /**
      * @return {@code true} if there is a call currently in progress.
      */
     private boolean isInCall() {
-        return getTelecommManager().isInCall();
+        return false;
     }
 
     private TelecomManager getTelecommManager() {
diff --git a/services/core/java/com/android/server/audio/AudioService.java b/services/core/java/com/android/server/audio/AudioService.java
index 6c56f8e..a842572 100644
--- a/services/core/java/com/android/server/audio/AudioService.java
+++ b/services/core/java/com/android/server/audio/AudioService.java
@@ -4131,20 +4131,8 @@ public class AudioService extends IAudioService.Stub
                 || adjust == AudioManager.ADJUST_TOGGLE_MUTE;
     }
 
-    /** only public for mocking/spying, do not call outside of AudioService */
-    @VisibleForTesting
-    public boolean isInCommunication() {
-        boolean IsInCall = false;
-
-        TelecomManager telecomManager =
-                (TelecomManager) mContext.getSystemService(Context.TELECOM_SERVICE);
-
-        final long ident = Binder.clearCallingIdentity();
-        IsInCall = telecomManager.isInCall();
-        Binder.restoreCallingIdentity(ident);
-
-        return (IsInCall || getMode() == AudioManager.MODE_IN_COMMUNICATION ||
-                getMode() == AudioManager.MODE_IN_CALL);
+    /*package*/ boolean isInCommunication() {
+        return false;
     }
 
     /**
diff --git a/services/java/com/android/server/SystemServer.java b/services/java/com/android/server/SystemServer.java
index 97e003c..1ac0b10 100644
--- a/services/java/com/android/server/SystemServer.java
+++ b/services/java/com/android/server/SystemServer.java
@@ -954,7 +954,7 @@ public final class SystemServer {
             traceBeginAndSlog("StartSchedulingPolicyService");
             ServiceManager.addService("scheduling_policy", new SchedulingPolicyService());
             traceEnd();
-
+/*
             traceBeginAndSlog("StartTelecomLoaderService");
             mSystemServiceManager.startService(TelecomLoaderService.class);
             traceEnd();
@@ -963,7 +963,7 @@ public final class SystemServer {
             telephonyRegistry = new TelephonyRegistry(context);
             ServiceManager.addService("telephony.registry", telephonyRegistry);
             traceEnd();
-
+*/
             traceBeginAndSlog("StartEntropyMixer");
             mEntropyMixer = new EntropyMixer(context);
             traceEnd();
@@ -1021,7 +1021,7 @@ public final class SystemServer {
             // WMS needs sensor service ready
             ConcurrentUtils.waitForFutureNoInterrupt(mSensorServiceStart, START_SENSOR_SERVICE);
             mSensorServiceStart = null;
-            wm = WindowManagerService.main(context, inputManager, !mFirstBoot, mOnlyCore,
+            wm = WindowManagerService.main(context, inputManager, false, mOnlyCore,
                     new PhoneWindowManager(), mActivityManagerService.mActivityTaskManager);
             ServiceManager.addService(Context.WINDOW_SERVICE, wm, /* allowIsolated= */ false,
                     DUMP_FLAG_PRIORITY_CRITICAL | DUMP_FLAG_PROTO);
diff --git a/telecomm/java/android/telecom/DefaultDialerManager.java b/telecomm/java/android/telecom/DefaultDialerManager.java
index 5b806a6..b51ab76 100644
--- a/telecomm/java/android/telecom/DefaultDialerManager.java
+++ b/telecomm/java/android/telecom/DefaultDialerManager.java
@@ -190,12 +190,7 @@ public class DefaultDialerManager {
      * @hide
      */
     public static boolean isDefaultOrSystemDialer(Context context, String packageName) {
-        if (TextUtils.isEmpty(packageName)) {
-            return false;
-        }
-        final TelecomManager tm = getTelecomManager(context);
-        return packageName.equals(tm.getDefaultDialerPackage())
-                || packageName.equals(tm.getSystemDialerPackage());
+        return false;
     }
 
     /**
-- 
2.7.4

