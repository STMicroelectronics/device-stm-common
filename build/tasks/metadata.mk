ifneq ($(filter stm32mp2, $(SOC_FAMILY)),)
ifneq ($(strip $(BOARD_METADATAIMAGE_PARTITION_SIZE)),)

TARGET_OUT_METADATA_IMG_PATH := $(PRODUCT_OUT)/metadata
INSTALLED_METADATAIMAGE_TARGET := $(PRODUCT_OUT)/metadata.img

$(INSTALLED_METADATAIMAGE_TARGET): $(MKF2FSUSERIMG) $(SELINUX_FC)
	@mkdir -p $(TARGET_OUT_METADATA_IMG_PATH)
	$(hide) PATH=$(HOST_OUT_EXECUTABLES):$${PATH} $(MKF2FSUSERIMG) $@ $(BOARD_METADATAIMAGE_PARTITION_SIZE) -S -f $(TARGET_OUT_METADATA_IMG_PATH) -D $(PRODUCT_OUT)/system -s $(SELINUX_FC) -t /metadata -L metadata --prjquota --casefold
	$(hide) chmod a+r $@
	$(hide) $(call assert-max-image-size,$@,$(BOARD_METADATAIMAGE_PARTITION_SIZE))

.PHONY: metadataimage
metadataimage: $(INSTALLED_METADATAIMAGE_TARGET)

droidcore: $(INSTALLED_METADATAIMAGE_TARGET)

endif
endif
